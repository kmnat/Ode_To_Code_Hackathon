<div class="game-page-container">
  <!-- Left Panel: Exploration Map - REMOVED -->
  <!-- 
  <div class="exploration-map-panel">
    <div class="map-header">Exploration Map</div>
    <div class="map-content">
      <app-tree-visualizer 
        [treeData]="decisionTree"
        [currentNode]="currentNode"
        [gameHistory]="gameHistory"
        [visitedChoices]="visitedChoices">
      </app-tree-visualizer>
    </div>
  </div>
  -->

  <!-- Right Panel: Game Content -->
  <div class="game-content-panel" style="width: 100%;"> <!-- Ensure it takes full width -->
    <div class="game-container">
      <mat-card class="game-card">
        <mat-card-header>
          <mat-card-title>Personal Trading And Investment Policy</mat-card-title>
          <mat-card-subtitle>Explore the branches of decision!</mat-card-subtitle>
          <div class="timer-display">{{ timerDisplay }}</div>
        </mat-card-header>

        <mat-card-content>
          <!-- Tree visualization -->
          <div class="tree-visualization">
            <div class="tree-path">
              <span *ngFor="let node of gameHistory; let i = index"
                    class="path-node"
                    [class.current-path-node]="i === gameHistory.length - 1">
                {{ i > 0 ? (wasPreviousChoiceYes(i) ? '➔ Yes' : '➔ No') : '' }} {{ node.question.substring(0, 20) }}{{ node.question.length > 20 ? '...' : ''}}
              </span>
            </div>

            <div class="current-node-display" [@fadeInOut]>
              <div class="node-icon">📈</div>
              <p [class.action-text]="currentNode.type === 'action'" class="question-text">
                {{ currentNode.question }}
              </p>
            </div>
          </div>

          <div class="choices-container" *ngIf="!isGameComplete" [@fadeInOut]>
            <button mat-fab extended color="primary"
                    (click)="makeChoice('yes')"
                    class="choice-button yes-button"
                    [class.traversed-choice]="hasChoiceBeenTraversed('yes')"
                    [disabled]="currentNode.yesChoiceCompleted">
              <span class="button-icon">👍</span> YES
            </button>
            <button mat-fab extended color="warn" 
                    (click)="makeChoice('no')" 
                    class="choice-button no-button"
                    [class.traversed-choice]="hasChoiceBeenTraversed('no')"
                    [disabled]="currentNode.noChoiceCompleted">
              <span class="button-icon">👎</span> NO
            </button>
          </div>

          <div class="game-complete" *ngIf="isGameComplete && !allPathsTraversed" [@fadeInOut]>
            <p class="complete-text">✨ You've reached the end of this branch! ✨</p>
            <button mat-raised-button color="primary" (click)="restartGame()" class="restart-button">
              <span class="button-icon">🔄</span> Play Again to explore other paths!
            </button>
            <button mat-stroked-button color="accent" (click)="goBack()" [disabled]="gameHistory.length <= 1" class="action-button back-button" style="margin-left: 10px;">
              <span class="button-icon">⏪</span> Go Back
            </button>
          </div>

          <div class="all-paths-complete" *ngIf="allPathsTraversed" [@fadeInOut]>
            <p class="complete-text" style="font-size: 1.5em; color: green;">🎉 Congratulations! 🎉</p>
            <p class="complete-text">You are done, you traversed all nodes and discovered all outcomes!</p>
            
            <div class="full-tree-display" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; text-align: left; max-height: 300px; overflow-y: auto;">
              <h4 style="margin-bottom: 10px; color: #34495e;">Full Decision Tree:</h4>
              <div *ngFor="let line of fullTreeTextLines"
                   [style.padding-left.px]="line.level * 15"
                   [style.color]="line.type === 'action' ? '#c0392b' : '#2c3e50'"
                   [style.font-weight]="line.type === 'action' ? 'bold' : 'normal'"
                   style="margin-bottom: 4px; font-size: 0.9em;">
                {{ line.text }}
              </div>
            </div>

            <button mat-raised-button color="warn" (click)="restartGame()" class="restart-button" style="margin-top: 20px;">
              <span class="button-icon">🔄</span> Restart Game
            </button>
          </div>
        </mat-card-content>

        <mat-card-actions *ngIf="!allPathsTraversed">
          <button mat-stroked-button color="accent" (click)="goBack()" [disabled]="gameHistory.length <= 1" class="action-button back-button">
            <span class="button-icon">⏪</span> Go Back
          </button>
          <button mat-stroked-button color="warn" (click)="restartGame()" class="action-button restart-main-button">
            <span class="button-icon">🔄</span> Restart Game
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
